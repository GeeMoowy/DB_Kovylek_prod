{% extends 'attendance/base.html' %}
{% block title %}Создание репетиции{% endblock %}
{% block content %}
<style>
    /* Основные стили для фона и карточки */
    body {
        background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 50%, #80deea 100%);
        min-height: 100vh;
        background-attachment: fixed;
    }

    .container.py-4 {
        padding-top: 2rem;
        padding-bottom: 2rem;
    }

    .card {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        background-color: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(5px);
    }

    .card-header {
        border-bottom: none;
        padding: 1.5rem;
    }

    /* Стили для формы */
    .form-control, .form-select {
        border-radius: 8px;
        border: 1px solid #ced4da;
        transition: all 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
        border-color: #4dd0e1;
        box-shadow: 0 0 0 0.25rem rgba(77, 208, 225, 0.25);
    }

    /* Стили для кнопок */
    .btn-success {
        background-color: #26c6da;
        border-color: #26c6da;
    }

    .btn-success:hover {
        background-color: #00bcd4;
        border-color: #00bcd4;
    }

    /* Анимации */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .card {
        animation: fadeIn 0.5s ease-out;
    }
</style>

<div class="container py-4">
    <div class="card shadow-lg">  <!-- shadow-lg для более выраженной тени -->
        <div class="card-header bg-primary text-white" style="background: linear-gradient(135deg, #00bcd4 0%, #008ba3 100%);">
            <h2 class="h5 mb-0">
                <i class="bi bi-calendar-plus me-2"></i>
                {% if object %}Редактирование репетиции{% else %}Создание репетиции{% endif %} для группы: {{ group }}
            </h2>
        </div>
        <div class="card-body p-4">
            <!-- Форма остается без изменений -->
            <form method="post" class="needs-validation" novalidate>
                {% csrf_token %}

                <!-- Поле даты -->
                <div class="mb-3">
                    <label for="id_date" class="form-label">
                        Дата занятия <span class="text-danger">*</span>
                    </label>
                    <div class="input-group date" id="datepicker">
                        <input type="text" class="form-control"
                               id="id_date" name="date"
                               value="{{ form.date.value|default_if_none:'' }}"
                               required>
                        <span class="input-group-text bg-light">
                            <i class="bi bi-calendar3 text-primary"></i>
                        </span>
                    </div>
                </div>

                <!-- Поле времени -->
                <div class="mb-3">
                    <label for="id_start_time" class="form-label">
                        Время начала <span class="text-danger">*</span>
                    </label>
                    <div class="input-group time" id="timepicker">
                        <input type="text" class="form-control"
                               id="id_start_time" name="start_time"
                               value="{{ form.start_time.value|default_if_none:'18:00' }}"
                               required>
                        <span class="input-group-text bg-light">
                            <i class="bi bi-clock text-primary"></i>
                        </span>
                    </div>
                </div>

                <!-- Остальные поля формы -->
                <div class="mb-3">
                    <label for="id_duration" class="form-label">
                        Длительность <span class="text-danger">*</span>
                    </label>
                    <select class="form-select" id="id_duration" name="duration" required>
                        {% for value, text in form.duration.field.choices %}
                            <option value="{{ value }}" {% if form.duration.value == value %}selected{% endif %}>
                                {{ text }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-4">
                    <label for="id_notes" class="form-label">Примечания</label>
                    <textarea class="form-control" id="id_notes" name="notes" rows="3">{{ form.notes.value|default_if_none:'' }}</textarea>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button type="submit" class="btn btn-success px-4 py-2">
                        <i class="bi bi-save me-2"></i> Сохранить
                    </button>
                    <a href="{% url 'attendance:repetition_list' pk=group.pk %}" class="btn btn-outline-primary px-4 py-2">
                        <i class="bi bi-x-circle me-2"></i> Отмена
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Подключаем Flatpickr -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>

<script>
    // Инициализация datepicker
    flatpickr("#id_date", {
        dateFormat: "Y-m-d",
        locale: "ru",
        allowInput: true,
        {% if form.date.value %}
        defaultDate: "{{ form.date.value|date:'Y-m-d' }}",
        {% else %}
        defaultDate: "today",
        {% endif %}
    });

    // Инициализация timepicker
    flatpickr("#id_start_time", {
        enableTime: true,
        noCalendar: true,
        dateFormat: "H:i",
        time_24hr: true,
        locale: "ru",
        defaultHour: 18,
        minuteIncrement: 5
    });

    // Валидация формы
    (function () {
        'use strict'
        const forms = document.querySelectorAll('.needs-validation')
        Array.from(forms).forEach(form => {
            form.addEventListener('submit', event => {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }
                form.classList.add('was-validated')
            }, false)
        })
    })()
</script>
{% endblock %}